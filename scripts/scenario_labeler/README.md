# 구현 의도 
지도학습(Supervised Learning) 기반의 금융 사기 탐지 모델을 효과적으로 학습시키기 위한 라벨 데이터를 구축하고 합니다.

## 1. 정의
- **이상 거래**
  -  보이스피싱, 대출사기, 자녀 사칭 등으로 피해자가 결제, 인출하거나 대포 계좌에 송금/이체한 것으로 추정되는 거래

- **사고 거래**  
  - 접수 완료된 피해자 구제 신청서에 입력된 피해자 계좌에서 대포 계좌로 송금/이체된 일련의 거래
- **라벨 정의**  
  - `1`: 이상 거래 및 사고 거래  
  - `0`: 이상 거래 및 사고 거래를 제외한 송금/이체된 일련의 거래

- **라벨링 단위**  
  거래 단위(Transaction-level)로 개별 거래에 대한 라벨을 부여합니다.

---

## 2. 기존 업무 과정 라벨링과 한계
1. 고객으로 부터 계좌리스트와 사기피해 발생 시점을 전달받아 `getES.py`를 통해 자동 라벨링
2. 위의 과정을 통해 수행한 라벨링 데이터를 통해 학습한 AI의 성능이 나쁜 경우 수동으로 라벨링 재수행

제공받은 계좌리스트와 사기피해 발생시점 데이터의 예시

| 구분                | 데이터 출처 예시                      | 적용 기준                        |
|---------------------|----------------------------------------|------------------------------|
| 수작업 레이블         | FDS 운영자, 보안 담당자 등 내부 검토 이력   | 운영자가 사기 거래로 판단하고 지급정지        |
| 고객 신고             | 콜센터 접수, 온라인 신고 시스템 등         | 허위 신고를 필터링하고 검증을 통해 확인된 신고 건 |
| 외부 기관 공유        | 금융보안원, 금융감독원, 타 금융기관 등     | 수동 라벨링 적용                    |

> [**한계점**]   
> 라벨링의 일관성과 품질 확보는 학습 데이터셋의 신뢰도를 결정짓는 중요한 요소입니다.  
> 작업자 개인의 해석에 따라 라벨 부여 기준이 달라질 수 있어, 결과적으로 라벨의 일관성과 재현 가능성 확보에 어려움이 존재하였습니다.  
표준화된 라벨링 전략의 도입이 필요하며, 시나리오 기반의 자동화된 라벨링 방식을 통해 이를 개선하고자 합니다.

---

## 3. 시나리오 기반 라벨링 도입

고객으로부터 제공받은 사기 계좌 및 대략적인 발생 시점을 기반으로 하여, 사기 거래 탐지를 위한 범용적이고 확장 가능한 라벨링 시나리오를 정의하고 자동화합니다.  


### 3.1 시나리오 구성 요건
아래 요건을 모두 충족하는 구조로 시나리오를 정의합니다. 
- **다중 인덱스 기반 탐지 지원**  
  거래 기록, 계좌 변경 이력, 고객 속성 등 다양한 Elasticsearch 인덱스를 활용하여 종합적인 탐지를 수행할 수 있어야 합니다.
- **개인화 탐지 조건의 적용 가능성**  
  Redis 등 외부 캐시 저장소에 보관된 개인별 이력(예: 최초 거래 시점, 블랙리스트 포함 여부 등)을 조건으로 활용할 수 있어야 합니다.
- **다단계 시나리오 구성 지원**  
  선행 탐지 시나리오의 결과가 후속 시나리오의 조건으로 연계될 수 있어야 하며, 탐지 로직은 계층적 구조를 가져야 합니다.

---

### 3.2 주요 구현 항목 및 처리 로직

1. **시나리오 정의 (`fraud_labeling_scenarios.yaml`)**  
   - 각 시나리오의 ID, 탐지 조건, 사용 인덱스, 캐시 키 등의 메타정보를 YAML 형식으로 선언합니다.
   - 외부 참조 키 또한 규칙 기반으로 정의할 수 있어야 하며, 유지보수와 확장성이 보장되어야 합니다.

2. **탐지 로직 구현 (Python 기반)**  
   - YAML 로 정의한 시나리오 조건을 파악하고, 해당 조건을 기반으로 거래별 탐지 로직을 실행합니다.
   - 탐지 조건이 충족된 경우 해당 거래에 라벨을 부여합니다.
    
3. **최초 탐지 시점 기준 라벨링**  
   - 탐지 조건을 처음으로 만족하는 거래를 기준 시점으로 간주하고, 해당 거래에 라벨 `1`을 부여합니다.

4. **기본(Fallback) 라벨링 적용**  
   - 어떠한 시나리오에도 해당되지 않는 거래는 제공받은 사기 발생일 내의 최초 고액 출금 등 기본 규칙에 따라 판단하여 라벨을 부여합니다.

5. **탐지 실패 거래 로그 기록 및 사후 분석 가능성 확보**  
   - 조건에 부합하지 않아 탐지되지 않은 거래는 로그로 별도 저장하며, 사후 정량적 분석 및 탐지 로직 개선에 활용됩니다.

---

## 4. 비고 및 향후 확장 방향
- FDS 탐지 시나리오와의 통합을 고려하여 설계했으며, 향후 AI 기반 룰 추천 시스템에서의 학습 데이터셋으로 활용을 기대합니다.

---
